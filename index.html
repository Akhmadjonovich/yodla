<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yodla AI ‚Äì Premium OCR</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>

    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #4f46e5;
            --success: #10b981;
            --error: #f43f5e;
            --bg: #fdfdff;
            --card-bg: #ffffff;
            --text: #0f172a;
            --muted: #64748b;
            --border: #f1f5f9;
            --radius: 20px;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        }

        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.2s ease; }

        body {
            background-color: var(--bg);
            background-image: 
                radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(16, 185, 129, 0.1) 0px, transparent 50%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            margin: 0;
            color: var(--text);
        }

        .container {
            width: 100%;
            max-width: 440px;
            background: var(--card-bg);
            border-radius: 30px;
            padding: 32px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.7);
            position: relative;
            overflow: hidden;
        }

        /* Dekorativ elementlar */
        .container::before {
            content: ""; position: absolute; top: -50px; right: -50px;
            width: 100px; height: 100px; background: var(--primary);
            filter: blur(80px); opacity: 0.1; z-index: 0;
        }

        h2 { font-weight: 800; font-size: 28px; text-align: center; margin-bottom: 24px; letter-spacing: -0.5px; z-index: 1; position: relative; }
        h2 span { color: var(--primary); }

        .input-group { margin-bottom: 20px; position: relative; z-index: 1; }
        
        input {
            width: 100%; padding: 16px 20px; border-radius: var(--radius);
            border: 2px solid var(--border); background: #f8fafc;
            font-size: 16px; font-weight: 500; outline: none;
        }

        input:focus { border-color: var(--primary-light); background: #fff; box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1); }

        .btn {
            width: 100%; padding: 16px; border-radius: var(--radius);
            border: none; font-size: 16px; font-weight: 700;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-bottom: 12px; z-index: 1; position: relative;
        }

        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
        .btn-primary:hover { background: var(--secondary); transform: translateY(-2px); }
        .btn-primary:active { transform: translateY(0); }

        .btn-outline { background: white; border: 2px solid var(--border); color: var(--text); }
        .btn-outline:hover { border-color: var(--primary-light); background: #f8fafc; }

        .btn-start { background: #0f172a; color: white; margin-top: 10px; }
        .btn-start:hover { background: #1e293b; }

        /* Test qismi */
        .progress-box { margin-bottom: 25px; }
        .progress-info { display: flex; justify-content: space-between; font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 8px; }
        .progress-bar { height: 12px; background: #f1f5f9; border-radius: 20px; overflow: hidden; }
        .progress-fill { 
            height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary), var(--success)); 
            border-radius: 20px; box-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
        }

        #question { font-size: 32px; font-weight: 800; text-align: center; margin: 30px 0; color: var(--text); letter-spacing: -1px; }

        .options-grid { display: grid; gap: 12px; }
        .option-btn {
            padding: 18px; border-radius: var(--radius); border: 2px solid var(--border);
            background: #fff; font-size: 16px; font-weight: 600; cursor: pointer;
            text-align: center;
        }
        .option-btn:hover:not(:disabled) { border-color: var(--primary); background: #f5f7ff; }

        /* Loading Overlay */
        #loading {
            position: fixed; inset: 0; background: rgba(255,255,255,0.8);
            backdrop-filter: blur(10px); display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 9999;
        }
        .spinner {
            width: 60px; height: 60px; border: 6px solid #f3f3f3;
            border-top: 6px solid var(--primary); border-radius: 50%;
            animation: spin 1s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .hidden { display: none !important; }

        .success-card { text-align: center; animation: scaleUp 0.5s ease; }
        @keyframes scaleUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        hr { border: 0; border-top: 1px solid var(--border); margin: 25px 0; }
    </style>
</head>
<body>

<div id="loading">
    <div class="spinner"></div>
    <p id="loading-text" style="margin-top:20px; font-weight:700; color: var(--primary)">Sun'iy intellekt ishlamoqda...</p>
</div>

<div class="container">
    <div id="setup">
        <h2>Yodla<span> 2.1</span></h2>
        
        <div class="input-group">
            <input id="de" placeholder="Chet tili (masalan: Haus)">
        </div>
        <div class="input-group">
            <input id="uz" placeholder="Tarjimasi (masalan: Uy)">
        </div>
        
        <button class="btn btn-primary" onclick="addWord()">
            <span>‚ûï</span> So‚Äòz qo‚Äòshish
        </button>

        <hr>

        <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="readImage(this)">
        <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none" onchange="readImage(this)">
        
        <button class="btn btn-outline" onclick="document.getElementById('fileInput').click()">
            <span>üìÅ</span> Galereyadan tanlash
        </button>
        <button class="btn btn-outline" style="border-color: var(--success); color: var(--success)" onclick="document.getElementById('cameraInput').click()">
            <span>üì∏</span> Kameradan skanerlash
        </button>

        <button class="btn btn-start" onclick="startTest()">
            ‚ñ∂ Testni boshlash
        </button>
        
        <p id="count" style="text-align:center; color:var(--muted); font-size:14px; margin-top:15px; font-weight:600;">0 ta so‚Äòz tayyor</p>
    </div>

    <div id="test" class="hidden">
        <div class="progress-box">
            <div class="progress-info">
                <span id="progress-percent">0% o'rganildi</span>
                <span id="remaining-count">Qoldi: 0</span>
            </div>
            <div class="progress-bar">
                <div id="bar" class="progress-fill"></div>
            </div>
        </div>

        <div id="question"></div>

        <div id="options" class="options-grid"></div>
    </div>

    <div id="done" class="hidden success-card">
        <div style="font-size: 80px; margin-bottom: 10px;">üèÜ</div>
        <h2 style="margin-bottom: 10px;">Ajoyib natija!</h2>
        <p style="color: var(--muted); margin-bottom: 30px;">Barcha so'zlarni xatosiz o'zlashtirdingiz.</p>
        <button class="btn btn-primary" onclick="location.reload()">üîÑ Yangi ro'yxat</button>
    </div>
</div>

<script>
    let allWords = [];
    let testQueue = [];
    let currentWord = null;
    let initialTotal = 0;

    function addWord() {
        const de = document.getElementById("de").value.trim();
        const uz = document.getElementById("uz").value.trim();
        if (de && uz) {
            allWords.push({ de, uz });
            document.getElementById("de").value = "";
            document.getElementById("uz").value = "";
            document.getElementById("de").focus();
            updateCount();
        }
    }

    function updateCount() {
        document.getElementById("count").innerText = `${allWords.length} ta so‚Äòz tayyor`;
    }

    async function readImage(input) {
        const file = input.files[0];
        if (!file) return;
        
        const loader = document.getElementById("loading");
        const loaderText = document.getElementById("loading-text");
        loader.style.display = "flex";
        loaderText.innerText = "Tasvir tahlil qilinmoqda...";

        try {
            const result = await Tesseract.recognize(file, 'deu+uzb+rus', {
                logger: m => { if(m.status === 'recognizing text') loaderText.innerText = `Skanerlash: ${Math.round(m.progress * 100)}%`; }
            });
            
            const lines = result.data.text.split("\n").filter(l => l.length > 2);
            let found = 0;
            lines.forEach(line => {
                let clean = line.replace(/^[0-9\s.]+/, "").trim();
                const parts = clean.split(/[-‚Äì‚Äî=:]/);
                if (parts.length >= 2) {
                    allWords.push({ de: parts[0].trim(), uz: parts[1].trim() });
                    found++;
                }
            });
            updateCount();
            if(found > 0) alert(`‚úÖ ${found} ta yangi so'z qo'shildi!`);
        } catch (e) { alert("Xatolik yuz berdi!"); }
        finally { loader.style.display = "none"; input.value = ""; }
    }

    function startTest() {
        if (allWords.length < 4) return alert("Test uchun kamida 4 ta so'z kerak!");
        testQueue = [...allWords].sort(() => Math.random() - 0.5);
        initialTotal = allWords.length;
        document.getElementById("setup").classList.add("hidden");
        document.getElementById("test").classList.remove("hidden");
        renderQuestion();
    }

    function renderQuestion() {
        if (testQueue.length === 0) {
            document.getElementById("test").classList.add("hidden");
            document.getElementById("done").classList.remove("hidden");
            return;
        }

        const solved = initialTotal - testQueue.length;
        const percent = Math.round((solved / initialTotal) * 100);
        document.getElementById("bar").style.width = percent + "%";
        document.getElementById("progress-percent").innerText = `${percent}% o'rganildi`;
        document.getElementById("remaining-count").innerText = `Qoldi: ${testQueue.length}`;

        currentWord = testQueue[0];
        document.getElementById("question").innerText = currentWord.de;

        let opts = [currentWord.uz];
        while (opts.length < 4) {
            let r = allWords[Math.floor(Math.random() * allWords.length)].uz;
            if (!opts.includes(r)) opts.push(r);
        }
        opts.sort(() => Math.random() - 0.5);

        const box = document.getElementById("options");
        box.innerHTML = "";
        opts.forEach(o => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.innerText = o;
            btn.onclick = () => check(o, btn);
            box.appendChild(btn);
        });
    }

    function check(selected, btn) {
        const allBtns = document.querySelectorAll(".option-btn");
        allBtns.forEach(b => b.disabled = true);

        if (selected === currentWord.uz) {
            btn.style.borderColor = "var(--success)";
            btn.style.background = "#f0fdf4";
            btn.style.color = "var(--success)";
            testQueue.shift();
            setTimeout(renderQuestion, 600);
        } else {
            btn.style.borderColor = "var(--error)";
            btn.style.background = "#fef2f2";
            btn.style.color = "var(--error)";
            
            allBtns.forEach(b => {
                if (b.innerText === currentWord.uz) {
                    b.style.borderColor = "var(--success)";
                }
            });

            let failed = testQueue.shift();
            testQueue.push(failed);
            setTimeout(renderQuestion, 1500);
        }
    }
</script>

</body>
</html>